<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CHANDANA_PROTOCOL_V22</title>
    <style>
        :root { --main: #ff66cc; --bg: #0d000d; }
        body { background-color: var(--bg); color: var(--main); font-family: 'Courier New', monospace; margin: 0; overflow: hidden; display: flex; align-items: center; justify-content: center; height: 100vh; }
        #game-container { width: 90%; max-width: 700px; border: 2px solid var(--main); padding: 30px; background: rgba(10, 0, 10, 0.9); z-index: 10; position: relative; box-shadow: 0 0 25px #ff33aa; }
        canvas { position: fixed; top: 0; left: 0; z-index: 1; opacity: 0.3; }
        input { background: transparent; border: none; color: #fff; font-family: 'Courier New', monospace; font-size: 1.2rem; width: 100%; outline: none; border-bottom: 1px solid var(--main); margin-top: 10px; }
        .system-msg { color: #888; font-size: 0.8rem; }
        .level-header { color: #00ffff; font-weight: bold; margin-bottom: 5px; }
        .hidden { display: none !important; }
        .btn-mash { background: var(--main); color: white; border: none; padding: 10px 20px; cursor: pointer; font-family: inherit; margin-top: 10px; }
        #output { min-height: 250px; }
    </style>
</head>
<body>

<canvas id="matrix-canvas"></canvas>

<div id="game-container">
    <div id="output"></div>
    
    <div id="input-area" class="input-line">
        <span>[APPU@AUTH] ~ > </span><input type="text" id="user-input" autocomplete="off" autofocus>
    </div>

    <div id="click-area" class="hidden">
        <button id="mash-btn" class="btn-mash">OVERRIDE SYSTEM</button>
        <p id="mash-count" style="font-size: 0.8rem; color: #888;"></p>
    </div>
</div>

<script>
    const input = document.getElementById('user-input');
    const output = document.getElementById('output');
    const inputArea = document.getElementById('input-area');
    const clickArea = document.getElementById('click-area');
    const mashBtn = document.getElementById('mash-btn');
    
    let currentLevel = 0;
    let clickCount = 0;

    /* --- LEVEL DEFINITIONS ---
       type: "text" (standard riddle)
       type: "glitch" (find number in matrix rain)
       type: "click" (mash the button)
    */
    const levels = [
        { type: "text", q: "INITIALIZING... IDENTIFY SUBJECT. (What does Appu call you?)", a: "coco" },
        { type: "text", q: "LEVEL 2: How many years of Senpai-energy have we reached today?", a: "22" },
        { type: "click", q: "LEVEL 3: SYSTEM STUCK. Force override by clicking the button 22 times.", a: 22 },
        { type: "text", q: "LEVEL 4: Binary Challenge. 01000010 01000110 01000110", a: "bff" },
        { type: "glitch", q: "LEVEL 5: Look into the data stream. A 4-digit key is falling in CYAN.", a: "2004" },
        { type: "text", q: "LEVEL 6: What was the name of that show we talked about?", a: "stranger things" },
        // ... Add more until you hit 22!
    ];

    // Helper to fill remaining levels for your test
    while(levels.length < 22) {
        levels.push({ type: "text", q: `LEVEL ${levels.length + 1}: Security Bypass. Type 'pass'`, a: "pass" });
    }

    async function loadLevel() {
        output.innerHTML = `<p class="system-msg">[LEVEL ${currentLevel + 1}/22]</p>`;
        const lvl = levels[currentLevel];
        
        await typeLine(`> ${lvl.q}`, "level-header");

        // UI Logic based on type
        if (lvl.type === "click") {
            inputArea.classList.add('hidden');
            clickArea.classList.remove('hidden');
            clickCount = 0;
            document.getElementById('mash-count').innerText = `Clicks: 0/${lvl.a}`;
        } else {
            inputArea.classList.remove('hidden');
            clickArea.classList.add('hidden');
            input.focus();
        }
    }

    // Pattern Logic: Button Mash
    mashBtn.onclick = () => {
        clickCount++;
        document.getElementById('mash-count').innerText = `Clicks: ${clickCount}/${levels[currentLevel].a}`;
        if (clickCount >= levels[currentLevel].a) {
            nextLevel();
        }
    };

    // Pattern Logic: Text Entry
    input.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') {
            const val = input.value.toLowerCase().trim();
            if (val === levels[currentLevel].a.toLowerCase()) {
                input.value = '';
                nextLevel();
            } else {
                typeLine("[ERROR] DENIED", "error");
            }
        }
    });

    async function nextLevel() {
        currentLevel++;
        if (currentLevel >= 22) {
            showWin();
        } else {
            loadLevel();
        }
    }

    function typeLine(text, className) {
        const p = document.createElement('p');
        p.className = className;
        output.appendChild(p);
        let i = 0;
        return new Promise(res => {
            const interval = setInterval(() => {
                p.innerHTML += text.charAt(i);
                i++;
                if (i >= text.length) { clearInterval(interval); res(); }
            }, 20);
        });
    }

    function showWin() {
        document.getElementById('game-container').innerHTML = `
            <div style="text-align:center">
                <h1 style="color:white; text-shadow: 0 0 20px #ff00ff;">ðŸ”“ OVERRIDE COMPLETE</h1>
                <p>Happy 22nd Birthday, Chandana!</p>
                <p>You've successfully hacked into my heart (cheesy, I know).</p>
                <p>- Appu</p>
            </div>
        `;
    }

    // Matrix Background Logic
    const canvas = document.getElementById('matrix-canvas');
    const ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth; canvas.height = window.innerHeight;
    const drops = Array(Math.floor(canvas.width / 16)).fill(1);

    function draw() {
        ctx.fillStyle = "rgba(13, 0, 13, 0.1)";
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        
        for (let i = 0; i < drops.length; i++) {
            const isSecret = levels[currentLevel]?.type === "glitch" && i === 10;
            ctx.fillStyle = isSecret ? "#00ffff" : "#ff66cc";
            ctx.font = isSecret ? "bold 20px monospace" : "16px monospace";
            
            const char = isSecret ? levels[currentLevel].a.charAt(Math.floor(Date.now()/200)%4) : "0123456789";
            ctx.fillText(char[Math.floor(Math.random()*char.length)], i * 16, drops[i] * 16);
            
            if (drops[i] * 16 > canvas.height && Math.random() > 0.975) drops[i] = 0;
            drops[i]++;
        }
    }
    setInterval(draw, 40);
    loadLevel();
</script>
</body>
</html>
